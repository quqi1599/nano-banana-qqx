; Supervisor 配置文件
; 用于管理 Celery Worker, Beat 和 Flower 进程
; 文件位置: /etc/supervisor/conf.d/celery.conf

; ============================================
; Celery Worker - 默认队列
; ============================================
[program:celery-worker]
; 启动命令
command=/usr/bin/python /path/to/nb-backend/venv/bin/celery -A app.celery_app worker --loglevel=info --concurrency=4
; 项目目录
directory=/path/to/nb-backend
; 运行用户
user=www-data
; 自动启动
autostart=true
; 自动重启
autorestart=true
; 启动延迟（秒）
startsecs=10
; 停止等待时间（秒）
stopwaitsecs=600
; 重定向标准输出
stdout_logfile=/var/log/celery/worker.log
; 重定向标准错误
stderr_logfile=/var/log/celery/worker_error.log
; 进程优先级
priority=999

; 环境变量
environment=CELERY_BROKER_URL="redis://localhost:6379/0"

; ============================================
; Celery Beat - 定时任务
; ============================================
[program:celery-beat]
command=/usr/bin/python /path/to/nb-backend/venv/bin/celery -A app.celery_app beat --loglevel=info
directory=/path/to/nb-backend
user=www-data
autostart=true
autorestart=true
startsecs=10
stopwaitsecs=60
stdout_logfile=/var/log/celery/beat.log
stderr_logfile=/var/log/celery/beat_error.log
priority=998

; ============================================
; Flower - 监控面板
; ============================================
[program:celery-flower]
command=/usr/bin/python /path/to/nb-backend/venv/bin/celery -A app.celery_app flower --port=5555 --basic_auth=admin:your_password
directory=/path/to/nb-backend
user=www-data
autostart=true
autorestart=true
startsecs=10
stdout_logfile=/var/log/celery/flower.log
stderr_logfile=/var/log/celery/flower_error.log
priority=997

; ============================================
; 组管理
; ============================================
[group:celery]
programs=celery-worker,celery-beat,celery-flower
priority=999
